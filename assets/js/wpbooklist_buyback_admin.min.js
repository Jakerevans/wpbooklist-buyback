console.log("This is the JavaScript Object that holds all PHP Variables for use in JavaScript"),console.log(wpbooklist_buyback_php_variables),jQuery(document).ready(function(w){"use strict";function b(t,e){t=t.split("--sep--seperator--sep--");console.log(t),w("#wpbooklist-buyback-checkout-div").html(t[2]);var i=JSON.parse(t[1]);t=JSON.parse(t[0]),console.log("pricingScheme"),console.log(i);if(console.log(t),null!=t&&null!=t.Items&&null!=t.Items.Item){var s=t.Items.Item.length;if(null==s&&(s=1),"initial"==e&&(a=s-1),"titlesearch"==e)var a=0;for(var o=a;o<s;o++){var l="",r="",n=0,u="";if(console.log(t),null!=t.Items.Item[o]){if(null!=t.Items.Item[o].OfferSummary&&null!=t.Items.Item[o].OfferSummary.LowestUsedPrice&&(t.Items.Item[o].OfferSummary.LowestUsedPrice.Amount,u=t.Items.Item[o].OfferSummary.LowestUsedPrice.FormattedPrice,n=t.Items.Item[o].SalesRank),null!=t.Items.Item[o].SimilarProducts&&null!=t.Items.Item[o].SimilarProducts.SimilarProduct)for(var b=0;b<t.Items.Item[o].SimilarProducts.SimilarProduct.length;b++)r=r+";bsp;"+t.Items.Item[o].SimilarProducts.SimilarProduct[b].ASIN+"---"+t.Items.Item[o].SimilarProducts.SimilarProduct[b].Title;null!=t.Items.Item[o].ASIN&&t.Items.Item[o].ASIN,null!=t.Items.Item[o].CustomerReviews&&null!=t.Items.Item[o].CustomerReviews.IFrameURL&&t.Items.Item[o].CustomerReviews.IFrameURL,null!=t.Items.Item[o].DetailPageURL&&t.Items.Item[o].DetailPageURL,null!=t.Items.Item[o].ItemAttributes&&(null!=t.Items.Item[o].ItemAttributes.Author&&t.Items.Item[o].ItemAttributes.Author,null!=t.Items.Item[o].ItemAttributes.EAN&&t.Items.Item[o].ItemAttributes.EAN,null!=t.Items.Item[o].ItemAttributes.NumberOfPages&&t.Items.Item[o].ItemAttributes.NumberOfPages,null!=t.Items.Item[o].ItemAttributes.Publisher&&t.Items.Item[o].ItemAttributes.Publisher,null!=t.Items.Item[o].ItemAttributes.PublicationDate&&t.Items.Item[o].ItemAttributes.PublicationDate,null!=t.Items.Item[o].ItemAttributes.Title&&t.Items.Item[o].ItemAttributes.Title),null!=t.Items.Item[o].LargeImage&&null!=t.Items.Item[o].LargeImage.URL?t.Items.Item[o].LargeImage.URL:"",null!=t.Items.Item[o].EditorialReviews&&null!=t.Items.Item[o].EditorialReviews.EditorialReview&&t.Items.Item[o].EditorialReviews.EditorialReview.Content&&(l=(l=(l=t.Items.Item[o].EditorialReviews.EditorialReview.Content).replace(/"/g,"'")).replace(/“/g,"'")),""==l&&null!=t.Items.Item[o].EditorialReviews&&null!=t.Items.Item[o].EditorialReviews.EditorialReview[0]&&(l=(l=(l=t.Items.Item[o].EditorialReviews.EditorialReview[0].Content).replace(/"/g,"'")).replace(/“/g,"'"))}else{if(null!=t.Items.Item.OfferSummary&&null!=t.Items.Item.OfferSummary.LowestUsedPrice&&(t.Items.Item.OfferSummary.LowestUsedPrice.Amount,u=t.Items.Item.OfferSummary.LowestUsedPrice.FormattedPrice,n=t.Items.Item.SalesRank),null!=t.Items.Item.SimilarProducts&&null!=t.Items.Item.SimilarProducts.SimilarProduct)for(b=0;b<t.Items.Item.SimilarProducts.SimilarProduct.length;b++)r=r+";bsp;"+t.Items.Item.SimilarProducts.SimilarProduct[b].ASIN+"---"+t.Items.Item.SimilarProducts.SimilarProduct[b].Title;null!=t.Items.Item.ASIN&&t.Items.Item.ASIN,null!=t.Items.Item.CustomerReviews&&null!=t.Items.Item.CustomerReviews.IFrameURL&&t.Items.Item.CustomerReviews.IFrameURL,null!=t.Items.Item.DetailPageURL&&t.Items.Item.DetailPageURL,null!=t.Items.Item.ItemAttributes&&(null!=t.Items.Item.ItemAttributes.Author&&t.Items.Item.ItemAttributes.Author,null!=t.Items.Item.ItemAttributes.EAN&&t.Items.Item.ItemAttributes.EAN,null!=t.Items.Item.ItemAttributes.NumberOfPages&&t.Items.Item.ItemAttributes.NumberOfPages,null!=t.Items.Item.ItemAttributes.Publisher&&t.Items.Item.ItemAttributes.Publisher,null!=t.Items.Item.ItemAttributes.PublicationDate&&t.Items.Item.ItemAttributes.PublicationDate,null!=t.Items.Item.ItemAttributes.Title&&t.Items.Item.ItemAttributes.Title),null!=t.Items.Item.LargeImage&&null!=t.Items.Item.LargeImage.URL?t.Items.Item.LargeImage.URL:"",null!=t.Items.Item.EditorialReviews&&null!=t.Items.Item.EditorialReviews.EditorialReview&&t.Items.Item.EditorialReviews.EditorialReview.Content&&(l=(l=(l=t.Items.Item.EditorialReviews.EditorialReview.Content).replace(/"/g,"'")).replace(/“/g,"'")),""==l&&null!=t.Items.Item.EditorialReviews&&null!=t.Items.Item.EditorialReviews.EditorialReview[0]&&(l=(l=(l=t.Items.Item.EditorialReviews.EditorialReview[0].Content).replace(/"/g,"'")).replace(/“/g,"'"))}console.log("pricingScheme[0]"),console.log(i[0]);var c=i[0].rankcalcs.split(";"),m=c.length,p=0,I=0,k=0;for(b=0;b<m;b++)if(0==p){var d=c[b].split("-");if(n>=parseInt(d[0])&&n<=parseInt(d[1]))p=u.substring(0,1)+(I=p=(u.substring(1)*(.01*d[2])).toFixed(2)),k=d[3]}(0==p||0==p||I<k)&&(p="Sorry, we're unable to purchase this title!","bottom:0; font-size:18px;","disabled",0)}return p}w("#wpbooklist-buyback-results-div").html("<p>Whoops! We couldn't find any results for your Book Search! Be sure to check the Title and/or Author you provided and try again!</p>"),w("#wpbooklist-buyback-results-div").animate({opacity:"1"}),w("#wpbooklist-spinner-buyback").animate({opacity:"0"})}w(document).on("change",".wpbooklist-buyback-settings-input",function(t){var e=w(this).attr("id"),i=e.split("-"),s=(parseInt(i[5]),w(".wpbooklist-buyback-settings-input").length),a=parseInt(w(this).val()),o=0;w(".wpbooklist-buyback-settings-input").each(function(t){w(this).attr("id")==e&&(o=t)});for(var l=o;l<s-1;l++){var r=w(".wpbooklist-buyback-settings-input")[l].id,n=parseInt(w("#"+r).val())+1,u=w(".wpbooklist-buyback-settings-input")[l+1].id,b=parseInt(w("#"+u).val());b<=a&&w("#"+u).val(n)}}),w(document).on("change",".wpbooklist-buyback-settings-input",function(t){var e=w(this).attr("id"),i=e.split("-"),s=(parseInt(i[5]),w(".wpbooklist-buyback-settings-input").length,parseInt(w(this).val())),a=0;w(".wpbooklist-buyback-settings-input").each(function(t){w(this).attr("id")==e&&(a=t)});for(var o=a;0<o;o--){var l=w(".wpbooklist-buyback-settings-input")[o].id,r=parseInt(w("#"+l).val())-1;console.log("nextNewVal"),console.log(r);var n=w(".wpbooklist-buyback-settings-input")[o-1].id,u=parseInt(w("#"+n).val());s<=u&&w("#"+n).val(r)}}),w(document).on("click","#wpbooklist-buyback-settings-add-row-div",function(t){var e=w(".wpbooklist-buyback-settings-input").length,i=w(".wpbooklist-buyback-settings-input")[e-1].id,s=parseInt(w("#"+i).val())+1,a=s+1,o=w(".wpbooklist-buyback-settings-input-perc").length,l=w(".wpbooklist-buyback-settings-input-perc")[o-1].id,r=parseInt(w("#"+l).val())-1;r<=0&&(r=1),w('<div class="wpbooklist-buyback-settings-row-actual"><div class="wpbooklist-buyback-settings-row-actual-inner-row"><div class="wpbooklist-buyback-settings-row-actual-inner-row-top"><p class="wpbooklist-buyback-settings-row-actual-inner-row-top-p1">Amazon Sales Ranking</p><p class="wpbooklist-buyback-settings-row-actual-inner-row-top-p2">Percentage of Amazon Book Price to offer</p></div><div class="wpbooklist-buyback-settings-row-actual-inner-row-bottom"><p class="wpbooklist-buyback-settings-row-actual-inner-row-from-to wpbooklist-buyback-settings-row-actual-inner-row-bottom-1">From: <input class="wpbooklist-buyback-settings-input" id=wpbooklist-buyback-settings-input-from-'+e+' type="number" value="'+s+'" />To: <input class="wpbooklist-buyback-settings-input" id=wpbooklist-buyback-settings-input-to-'+e+' type="number" value="'+a+'" /></p><p style="position:relative; left:3px;" class="wpbooklist-buyback-settings-row-actual-inner-row-bottom-2">Percentage:<input style="margin-left:4px;"class="wpbooklist-buyback-settings-input-perc" id=wpbooklist-buyback-settings-input-perc-'+e+' type="number" value="'+r+'" />%</p><p style="position:relative; left:8px;" class="wpbooklist-buyback-settings-row-actual-inner-row-bottom-3">Threshold:<input style="margin-left:4px;" class="wpbooklist-buyback-settings-input-perc" id=wpbooklist-buyback-settings-input-threshold-'+e+' type="number" step="0.01" value="8.00" /></p></div></div></div>').insertBefore(w(this).parent()),w("#wpbooklist-buyback-settings-delete-row-div").removeAttr("disabled")}),w(document).on("click","#wpbooklist-buyback-settings-delete-row-div",function(t){var e=w(".wpbooklist-buyback-settings-row-actual").length;1<e?w(".wpbooklist-buyback-settings-row-actual")[e-1].remove():w(this).attr("disabled","true")}),w(document).on("click","#wpbooklist-buyback-settings-save-div button",function(t){var e="";w("#wpbooklist-spinner-buyback").animate({opacity:"1"}),w(".wpbooklist-buyback-settings-row-actual").each(function(){w(this).find("input").each(function(){e+=w(this).val()+"-"}),e+="0;"}),e=e.substring(0,e.length-1);var i={action:"wpbooklist_buyback_save_settings_action",security:wpbooklist_buyback_php_variables.wpbooklistbuybacknonce11,settingstring:e};w.ajax({url:ajaxurl,type:"POST",data:i,timeout:0,success:function(t){document.location.reload(!0)}})}),w(document).on("click",".wpbooklist-buyback-settings-save-changes-row-div",function(t){var a="",e=w(this).attr("data-orderid");w("#wpbooklist-buyback-settings-row-actual-"+e+" .wpbooklist-buyback-cart-div-row").each(function(){var t=w(this).find(".wpbooklist-buyback-cart-img-actual").attr("src"),e=w(this).find(".wpbooklist-buyback-cart-title-actual").text(),i=w(this).find(".wpbooklist-buyback-cart-title-isbn-actual").text(),s=w(this).find(".wpbooklist-buyback-cart-value-actual").text().replace("$","");a=a+i+";;;"+e+";;;"+t+";;;"+s+"----"}),console.log("booksstringfordb"),console.log(a);var i=w("#wpbooklist-buyback-select-id-"+e).val();w("#"+e+" #wpbooklist-spinner-buyback").animate({opacity:"1"});var s={action:"wpbooklist_buyback_save_order_changes_action",security:wpbooklist_buyback_php_variables.wpbooklistbuybacknonce12,orderStatus:i,orderId:e,books:a};w.ajax({url:ajaxurl,type:"POST",data:s,timeout:0,success:function(t){document.location.reload(!0)}})}),w(document).on("click",".wpbooklist-buyback-settings-delete-order-row-div",function(t){var e=w(this).attr("data-orderid");w("#wpbooklist-spinner-buyback").animate({opacity:"1"});var i={action:"wpbooklist_buyback_delete_order_changes_action",security:wpbooklist_buyback_php_variables.wpbooklistbuybacknonce13,orderId:e};w.ajax({url:ajaxurl,type:"POST",data:i,timeout:0,success:function(t){document.location.reload(!0),console.log(t)}})}),w(document).on("click",".wpbooklist-buyback-settings-recalculate-order-row-div",function(t){var o=w(this).attr("data-orderid");o="wpbooklist-buyback-settings-row-actual-"+o,console.log();var e=w(this).attr("data-allisbns");e=e.substring(1);var i="";if(-1<window.location.search.indexOf("buybackusername=")){var s=new URL(window.location.href);i=s.searchParams.get("buybackusername")}w("#"+o+" #wpbooklist-spinner-buyback").animate({opacity:"1"}),w("#"+o+" #wpbooklist-buyback-results-div").animate({opacity:"0"}),w("#"+o+" #wpbooklist-buyback-results-div").animate({opacity:0});for(var l="",r=e.split(","),n=0,a=r.length-1;0<=a;a--){var u={action:"wpbooklist_buyback_search_action",security:wpbooklist_buyback_php_variables.wpbooklistbuybacknonce3,isbn:r[a],username:i};w.ajax({url:ajaxurl,type:"POST",data:u,timeout:0,success:function(t){n++,","==(l+=","+b(t,"initial")).charAt(0)&&(l=l.substring(1));for(var e=l.split(","),i=0,s=0;s<e.length;s++){var a=w(".wpbooklist-buyback-cart-value-actual");a.eq(s).text(e[s]),i+=parseFloat(e[s].substring(1))}i=i.toFixed(2),w("#"+o+" #wpbooklist-buyback-admin-order-total").text(i),n==r.length&&w("#"+o+" #wpbooklist-spinner-buyback").animate({opacity:"0"})}})}}),w(document).on("click",".wpbooklist-buyback-cart-value-remove-div",function(t){w(this).parent().parent().remove();var e=w("#wpbooklist-buyback-cart-summary-span-total-calc").text();w("#wpbooklist-buyback-cart-summary-span-total-calc").text(parseInt(e)-1);var i=w(this).attr("data-isbntoremove"),s=w(this).attr("data-orderid"),a=w("#wpbooklist-buyback-settings-recalculate-order-row-div-"+s).attr("data-allisbns");a=(a=a.replace(i,"")).replace(/,,/g,","),w("#wpbooklist-buyback-settings-recalculate-order-row-div-"+s).attr("data-allisbns",a),w("#wpbooklist-buyback-cart-summary-span-value-calc").text();var o=w(this).prev().text();o=o.replace("$",""),w("#wpbooklist-buyback-cart-summary-span-value-calc").text((parseFloat(w("#wpbooklist-buyback-cart-summary-span-value-calc").text())-parseFloat(o)).toFixed(2))})});