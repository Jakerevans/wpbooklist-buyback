/**
 * JavaScript Admin Functions - wpbooklist-buyback-admin.min.js
 *
 * @author   Jake Evans
 * @category JavaScript
 * @package  Includes/Assets/Js
 * @version  2.0.0
 */

console.log('This is the JavaScript Object that holds all PHP Variables for use in JavaScript')
console.log(wpbooklist_buyback_php_variables)


// All functions wrapped in jQuery(document).ready()...
jQuery(document).ready(function($) {
	"use strict";

	/* BEGINNING SECTION TO CALL ALL FUNCTIONS IN FILE... */
	wpbooklist_buyback_jre_auto_adjust_sales_inputs_1();

	wpbooklist_buyback_jre_auto_adjust_sales_inputs_2();

	wpbooklist_buyback_jre_add_sales_row();

	wpbooklist_buyback_jre_delete_sales_row();

	wpbooklist_buyback_jre_save_sales_data();

	wpbooklist_buyback_jre_save_order_changes();

	wpbooklist_buyback_jre_delete_existing_order();

	wpbooklist_buyback_jre_recalculate_existing_order();

	wpbooklist_buyback_jre_remove_book_from_order();


	/* ENDING SECTION TO CALL ALL FUNCTIONS IN FILE... */

	// A function that auto-adjusts the numerical values in the Sales Ranking fields
	function wpbooklist_buyback_jre_auto_adjust_sales_inputs_1(){

		$(document).on("change",".wpbooklist-buyback-settings-input", function(event){

			var thisId = $(this).attr('id');
			var splitId = thisId.split('-');
			var thisIdNum = parseInt(splitId[5]);
			var totalInputs = $('.wpbooklist-buyback-settings-input').length;
			var thisVal = parseInt($(this).val());

			var iNum = 0;
			$('.wpbooklist-buyback-settings-input').each(function(index){
				if($(this).attr('id') == thisId){
					iNum = index;
				}
			})

			for (var i = iNum; i < (totalInputs-1); i++) {

				var curValId = $('.wpbooklist-buyback-settings-input')[i].id
				var nextNewVal = parseInt($('#'+curValId).val())+1;

				var nextId = $('.wpbooklist-buyback-settings-input')[i+1].id
				var nextCurrentVal = parseInt($('#'+nextId).val());

				if(nextCurrentVal <= thisVal){
					$('#'+nextId).val(nextNewVal);
				}
			}
		});

	}

	// A function that auto-adjusts the numerical values in the Sales Ranking fields
	function wpbooklist_buyback_jre_auto_adjust_sales_inputs_2(){

		$(document).on("change",".wpbooklist-buyback-settings-input", function(event){

			var thisId = $(this).attr('id');
			var splitId = thisId.split('-');
			var thisIdNum = parseInt(splitId[5]);
			var totalInputs = $('.wpbooklist-buyback-settings-input').length;
			var thisVal = parseInt($(this).val());

			var iNum = 0;
			$('.wpbooklist-buyback-settings-input').each(function(index){
				if($(this).attr('id') == thisId){
					iNum = index;
				}
			})

			for (var i = iNum; i > 0; i--) {

				var curValId = $('.wpbooklist-buyback-settings-input')[i].id
				var nextNewVal = parseInt($('#'+curValId).val())-1;

				console.log('nextNewVal')
				console.log(nextNewVal)

				var nextId = $('.wpbooklist-buyback-settings-input')[i-1].id
				var nextCurrentVal = parseInt($('#'+nextId).val());

				if(nextCurrentVal >= thisVal){
					$('#'+nextId).val(nextNewVal);
				}
			}
		});
	}

	// Function that adds a row to the Sales Ranking settings page
	function wpbooklist_buyback_jre_add_sales_row(){
		$(document).on("click","#wpbooklist-buyback-settings-add-row-div", function(event){

			var nextNum = $('.wpbooklist-buyback-settings-input').length

			var secondLastId = $('.wpbooklist-buyback-settings-input')[nextNum-1].id;
			var nextFrom = parseInt($('#'+secondLastId).val())+1;
			var nextTo = nextFrom+1;

			var nextPercNum = $('.wpbooklist-buyback-settings-input-perc').length
			var LastPercId = $('.wpbooklist-buyback-settings-input-perc')[nextPercNum-1].id;
			var nextPerc = parseInt($('#'+LastPercId).val())-1;

			if(nextPerc <= 0){
				nextPerc = 1;
			}

			$('<div class="wpbooklist-buyback-settings-row-actual"><div class="wpbooklist-buyback-settings-row-actual-inner-row"><div class="wpbooklist-buyback-settings-row-actual-inner-row-top"><p class="wpbooklist-buyback-settings-row-actual-inner-row-top-p1">Amazon Sales Ranking</p><p class="wpbooklist-buyback-settings-row-actual-inner-row-top-p2">Percentage of Amazon Book Price to offer</p></div><div class="wpbooklist-buyback-settings-row-actual-inner-row-bottom"><p class="wpbooklist-buyback-settings-row-actual-inner-row-bottom-1">From: <input class="wpbooklist-buyback-settings-input" id=wpbooklist-buyback-settings-input-from-'+nextNum+' type="number" value="'+nextFrom+'" />To: <input class="wpbooklist-buyback-settings-input" id=wpbooklist-buyback-settings-input-to-'+nextNum+' type="number" value="'+nextTo+'" /></p><p style="position:relative; left:3px;" class="wpbooklist-buyback-settings-row-actual-inner-row-bottom-2">Percentage:<input style="margin-left:4px;"class="wpbooklist-buyback-settings-input-perc" id=wpbooklist-buyback-settings-input-perc-'+nextNum+' type="number" value="'+nextPerc+'" />%</p><p style="position:relative; left:8px;" class="wpbooklist-buyback-settings-row-actual-inner-row-bottom-3">Threshold:<input style="margin-left:4px;" class="wpbooklist-buyback-settings-input-perc" id=wpbooklist-buyback-settings-input-threshold-'+nextNum+' type="number" step="0.01" value="8.00" /></p></div></div></div>').insertBefore($(this).parent())

			$("#wpbooklist-buyback-settings-delete-row-div").removeAttr('disabled')
		});
	}


	// Function that deletes a row to the Sales Ranking settings page
	function wpbooklist_buyback_jre_delete_sales_row(){

		$(document).on("click","#wpbooklist-buyback-settings-delete-row-div", function(event){
			var idNumToRemove = $('.wpbooklist-buyback-settings-row-actual').length
			if(idNumToRemove > 1){
				var idToRemove = $('.wpbooklist-buyback-settings-row-actual')[idNumToRemove-1].remove()
			} else {
				$(this).attr('disabled','true')
			}
		});
	}

	// Function that deletes a row of the Sales Ranking settings page
	function wpbooklist_buyback_jre_save_sales_data(){

		$(document).on("click","#wpbooklist-buyback-settings-save-div button", function(event){
			var settingstring = '';
			$('#wpbooklist-spinner-buyback').animate({'opacity':'1'})
			$('.wpbooklist-buyback-settings-row-actual').each(function(){

				$(this).find('input').each(function(){
					settingstring += $(this).val()+'-';
				})
				settingstring += '0;';
			})

			settingstring = settingstring.substring(0, settingstring.length - 1);

			var data = {
				'action': 'wpbooklist_buyback_save_settings_action',
				'security': wpbooklist_buyback_php_variables.wpbooklistbuybacknonce11,
				'settingstring':settingstring,
			};

			var request = $.ajax({
			    url: ajaxurl,
			    type: "POST",
			    data:data,
			    timeout: 0,
			    success: function(response) {

			    	document.location.reload(true);

			    }
			});

		});
	}

	// Function that saves changes to existing orders
	function wpbooklist_buyback_jre_save_order_changes(){
		$(document).on("click",".wpbooklist-buyback-settings-save-changes-row-div", function(event){


			// Build Books string from cart
			var books = '';
			var orderId = $(this).attr('data-orderid');
			$('#wpbooklist-buyback-settings-row-actual-'+orderId+' .wpbooklist-buyback-cart-div-row').each(function(){
				//9780553448146;;;Artemis: A Novel;;;https://images-na.ssl-images-amazon.com/images/I/41mpiaisIIL.jpg;;;2.49----9781492650959;;;The Radium Girls: The Dark Story of America\&#39;s Shining Women;;;https://images-na.ssl-images-amazon.com/images/I/51t86%2BXZO3L.jpg;;;3.36----9781492650959;;;The Radium Girls: The Dark Story of America\&#39;s Shining Women;;;https://images-na.ssl-images-amazon.com/images/I/51t86%2BXZO3L.jpg;;;3.36

				var imgsrc = $(this).find('.wpbooklist-buyback-cart-img-actual').attr('src');
				var title = $(this).find('.wpbooklist-buyback-cart-title-actual').text();
				var isbn = $(this).find('.wpbooklist-buyback-cart-title-isbn-actual').text();
				var value = $(this).find('.wpbooklist-buyback-cart-value-actual').text().replace('$','');

				books = books+isbn+';;;'+title+';;;'+imgsrc+';;;'+value+'----';
			});

			console.log('booksstringfordb')
			console.log(books)




			var orderStatus = $('#wpbooklist-buyback-select-id-'+orderId).val();
			$('#'+orderId+' #wpbooklist-spinner-buyback').animate({'opacity':'1'})

			var data = {
				'action': 'wpbooklist_buyback_save_order_changes_action',
				'security': wpbooklist_buyback_php_variables.wpbooklistbuybacknonce12,
				'orderStatus':orderStatus,
				'orderId':orderId,
				'books':books,
			};

			var request = $.ajax({
			    url: ajaxurl,
			    type: "POST",
			    data:data,
			    timeout: 0,
			    success: function(response) {
			    	document.location.reload(true);
			    }
			});
		});
	}

	// Function that deletes an existing order
	function wpbooklist_buyback_jre_delete_existing_order(){
		$(document).on("click",".wpbooklist-buyback-settings-delete-order-row-div", function(event){
			var orderId = $(this).attr('data-orderid');
			$('#wpbooklist-spinner-buyback').animate({'opacity':'1'})

			var data = {
				'action': 'wpbooklist_buyback_delete_order_changes_action',
				'security': wpbooklist_buyback_php_variables.wpbooklistbuybacknonce13,
				'orderId':orderId,
			};

			var request = $.ajax({
			    url: ajaxurl,
			    type: "POST",
			    data:data,
			    timeout: 0,
			    success: function(response) {
			    	document.location.reload(true);
			    	console.log(response)

			    }
			});
		});
	}

	// Function that recalcuates the prices for an existing order
	function wpbooklist_buyback_jre_recalculate_existing_order(){

		$(document).on("click",".wpbooklist-buyback-settings-recalculate-order-row-div", function(event){

			var orderid = $(this).attr('data-orderid');
			orderid = 'wpbooklist-buyback-settings-row-actual-'+orderid;

			console.log()
			var isbnstring = $(this).attr('data-allisbns');
			isbnstring = isbnstring.substring(1);
			var username = '';

			if (window.location.search.indexOf('buybackusername=') > -1) {
				var url = new URL(window.location.href);
				username = url.searchParams.get("buybackusername");
			}


			$('#'+orderid+' #wpbooklist-spinner-buyback').animate({'opacity':'1'})
			$('#'+orderid+' #wpbooklist-buyback-results-div').animate({'opacity':'0'})

			$('#'+orderid+' #wpbooklist-buyback-results-div').animate({opacity:0});

			var finalPriceString = '';
			var isbnarray = isbnstring.split(',');
			var ajaxCounter = 0;
			for (var i = isbnarray.length - 1; i >= 0; i--) {
				var data = {
					'action': 'wpbooklist_buyback_search_action',
					'security': wpbooklist_buyback_php_variables.wpbooklistbuybacknonce3,
					'isbn':isbnarray[i],
					'username':username
				};

				var request = $.ajax({
				    url: ajaxurl,
				    type: "POST",
				    data:data,
				    timeout: 0,
				    success: function(response) {

				    	ajaxCounter++;

				    	finalPriceString += ',' + wpbooklist_buyback_jre_handle_admin_update_results(response, 'initial');

						if(finalPriceString.charAt(0) == ','){
							finalPriceString = finalPriceString.substring(1);
				    	}

				    	var finalPriceArray = finalPriceString.split(',');

				    	var finalNewOrderTotal = 0.00;
						for (var j = 0; j < finalPriceArray.length; j++) {
							var domPrice = $('.wpbooklist-buyback-cart-value-actual');
							domPrice.eq(j).text(finalPriceArray[j])
							finalNewOrderTotal += parseFloat( finalPriceArray[j].substring(1));
						}

						finalNewOrderTotal = finalNewOrderTotal.toFixed(2)
						$('#'+orderid+' #wpbooklist-buyback-admin-order-total').text(finalNewOrderTotal)

						if(ajaxCounter == isbnarray.length){
							$('#'+orderid+' #wpbooklist-spinner-buyback').animate({'opacity':'0'})
						}
				    }
				});
			}
		});
	}


	// Function that removes a book from an order
	function wpbooklist_buyback_jre_remove_book_from_order(){
		$(document).on("click",".wpbooklist-buyback-cart-value-remove-div", function(event){
			$(this).parent().parent().remove()

			// Adjust cart totals/values
			var currentNum = $('#wpbooklist-buyback-cart-summary-span-total-calc').text();
			$('#wpbooklist-buyback-cart-summary-span-total-calc').text(parseInt(currentNum)-1)

			var isbntoremove = $(this).attr('data-isbntoremove');
			var orderid = $(this).attr('data-orderid');
			var oldrecalcstring = $('#wpbooklist-buyback-settings-recalculate-order-row-div-'+orderid).attr('data-allisbns')

			oldrecalcstring = oldrecalcstring.replace(isbntoremove,'');
			oldrecalcstring = oldrecalcstring.replace(/,,/g, ',');
			$('#wpbooklist-buyback-settings-recalculate-order-row-div-'+orderid).attr('data-allisbns', oldrecalcstring)

			var currentVal = $('#wpbooklist-buyback-cart-summary-span-value-calc').text();
			var bookVal = $(this).prev().text()
			bookVal = bookVal.replace('$','');
			$('#wpbooklist-buyback-cart-summary-span-value-calc').text((parseFloat($('#wpbooklist-buyback-cart-summary-span-value-calc').text())-parseFloat(bookVal)).toFixed(2))

		});
	}




	// Function that handles the returning of book results
	function wpbooklist_buyback_jre_handle_admin_update_results(results, phase){

		var origResponse = results;
		var results = results.split('--sep--seperator--sep--');

		console.log(results)


		// Add the returned form to the DOM
		$('#wpbooklist-buyback-checkout-div').html(results[2]);

		var pricingScheme = JSON.parse(results[1]);
    	results = JSON.parse(results[0]);

    	console.log('pricingScheme')
    	console.log(pricingScheme)
    	
    	var html = '<div id="wpbooklist-buyback-results-container"><div id="wpbooklist-buyback-add-books-div"><div id="wpbooklist-buyback-library-select"></div></div></div>';

		console.log(results);
    	if(results == undefined || results.Items == undefined || results.Items.Item == undefined){
    		$('#wpbooklist-buyback-results-div').html('<p>Whoops! We couldn\'t find any results for your Book Search! Be sure to check the Title and/or Author you provided and try again!</p>' );
	    	$('#wpbooklist-buyback-results-div').animate({'opacity':'1'});
	    	$('#wpbooklist-spinner-buyback').animate({'opacity':'0'});
    	} else {

    		var resultsLength = results.Items.Item.length;
	    	if(resultsLength == undefined){
	    		resultsLength = 1;
	    	}

	    	if(phase == 'initial'){
	    		loopControl = resultsLength-1;
	    	}

	    	if(phase == 'titlesearch'){
	    		var loopControl = 0
	    	}

	    	for (var i = loopControl; i < resultsLength; i++) {
	    		var image = '';
	    		var author = '';
	    		var category = '';
	    		var pages = '';
	    		var publisher = '';
	    		var pubdate = '';
	    		var title = '';
	    		var description = '';
	    		var isbn = '';
	    		var review = '';
	    		var similar = '';
	    		var image = '';
	    		var isbn = '';
	    		var details = '';
	    		var similarproductsstring = '';
	    		var itemRank = 0;
	    		var lowestUsedUnformatted = '';
	    		var lowestUsedFormatted = '';

	    		console.log(results)

	    		if(results.Items.Item[i] != undefined){


	    			// Get rank and pricing data
	    			if(results.Items.Item[i].OfferSummary != undefined && results.Items.Item[i].OfferSummary.LowestUsedPrice != undefined){
		    			lowestUsedUnformatted = results.Items.Item[i].OfferSummary.LowestUsedPrice.Amount;
		    			lowestUsedFormatted = results.Items.Item[i].OfferSummary.LowestUsedPrice.FormattedPrice;
		    			itemRank = results.Items.Item[i].SalesRank;
	    			}

	    			// Get other data
	    			if(results.Items.Item[i].SimilarProducts != undefined){
		    			if(results.Items.Item[i].SimilarProducts.SimilarProduct != undefined){
		    				for (var r = 0; r < results.Items.Item[i].SimilarProducts.SimilarProduct.length; r++) {
		    					similarproductsstring = similarproductsstring+';bsp;'+results.Items.Item[i].SimilarProducts.SimilarProduct[r].ASIN+'---'+results.Items.Item[i].SimilarProducts.SimilarProduct[r].Title;
		    				};
		    			}
	    			}


	    			if(results.Items.Item[i].ASIN != undefined){
	    				isbn = results.Items.Item[i].ASIN;
	    			}

	    			if(results.Items.Item[i].CustomerReviews != undefined){
	    				if(results.Items.Item[i].CustomerReviews.IFrameURL != undefined){
	    					review = results.Items.Item[i].CustomerReviews.IFrameURL;
	    				}
	    			}

	    			if(results.Items.Item[i].DetailPageURL != undefined){
	    				details = results.Items.Item[i].DetailPageURL;
	    			}

	    			if(results.Items.Item[i].ItemAttributes != undefined){

		    			if(results.Items.Item[i].ItemAttributes.Author != undefined){
		    				author = results.Items.Item[i].ItemAttributes.Author;
		    			}

		    			if(results.Items.Item[i].ItemAttributes.EAN != undefined){
		    				isbn = results.Items.Item[i].ItemAttributes.EAN;
		    			}

		    			if(results.Items.Item[i].ItemAttributes.NumberOfPages != undefined){
		    				pages = results.Items.Item[i].ItemAttributes.NumberOfPages;
		    			}

		    			if(results.Items.Item[i].ItemAttributes.Publisher != undefined){
		    				publisher = results.Items.Item[i].ItemAttributes.Publisher;
		    			}

		    			if(results.Items.Item[i].ItemAttributes.PublicationDate != undefined){
		    				pubdate = results.Items.Item[i].ItemAttributes.PublicationDate;
		    			}

		    			if(results.Items.Item[i].ItemAttributes.Title != undefined){
		    				title = results.Items.Item[i].ItemAttributes.Title;
		    			}
	    			}

	    			if(results.Items.Item[i].LargeImage != undefined && results.Items.Item[i].LargeImage.URL != undefined){
	    				image = results.Items.Item[i].LargeImage.URL;
	    			} else {
	    				image = '';
	    			}

	    			if(results.Items.Item[i].EditorialReviews != undefined && results.Items.Item[i].EditorialReviews.EditorialReview != undefined && results.Items.Item[i].EditorialReviews.EditorialReview.Content){
	    				description = results.Items.Item[i].EditorialReviews.EditorialReview.Content;
	    				description = description.replace(/"/g,'\'');
	    				description = description.replace(/“/g,'\'');
	    			}

	    			if(description == ''){
	    				if(results.Items.Item[i].EditorialReviews != undefined && results.Items.Item[i].EditorialReviews.EditorialReview[0] != undefined){
		    				description = results.Items.Item[i].EditorialReviews.EditorialReview[0].Content;
		    				description = description.replace(/"/g,'\'');
		    				description = description.replace(/“/g,'\'');
	    				}
	    			}
	    		} else {

	    			// Get rank and pricing data
	    			if(results.Items.Item.OfferSummary != undefined && results.Items.Item.OfferSummary.LowestUsedPrice != undefined){
		    			lowestUsedUnformatted = results.Items.Item.OfferSummary.LowestUsedPrice.Amount;
		    			lowestUsedFormatted = results.Items.Item.OfferSummary.LowestUsedPrice.FormattedPrice;
		    			itemRank = results.Items.Item.SalesRank;
	    			}

	    			if(results.Items.Item.SimilarProducts != undefined){
		    			if(results.Items.Item.SimilarProducts.SimilarProduct != undefined){
		    				for (var r = 0; r < results.Items.Item.SimilarProducts.SimilarProduct.length; r++) {
		    					similarproductsstring = similarproductsstring+';bsp;'+results.Items.Item.SimilarProducts.SimilarProduct[r].ASIN+'---'+results.Items.Item.SimilarProducts.SimilarProduct[r].Title;
		    				};
		    			}
	    			}

	    			//console.log(similarproductsstring);

	    			if(results.Items.Item.ASIN != undefined){
	    				isbn = results.Items.Item.ASIN;
	    			}

	    			if(results.Items.Item.CustomerReviews != undefined){
	    				if(results.Items.Item.CustomerReviews.IFrameURL != undefined){
	    					review = results.Items.Item.CustomerReviews.IFrameURL;
	    				}
	    			}

	    			if(results.Items.Item.DetailPageURL != undefined){
	    				details = results.Items.Item.DetailPageURL;
	    			}

	    			if(results.Items.Item.ItemAttributes != undefined){

		    			if(results.Items.Item.ItemAttributes.Author != undefined){
		    				author = results.Items.Item.ItemAttributes.Author;
		    			}

		    			if(results.Items.Item.ItemAttributes.EAN != undefined){
		    				isbn = results.Items.Item.ItemAttributes.EAN;
		    			}

		    			if(results.Items.Item.ItemAttributes.NumberOfPages != undefined){
		    				pages = results.Items.Item.ItemAttributes.NumberOfPages;
		    			}

		    			if(results.Items.Item.ItemAttributes.Publisher != undefined){
		    				publisher = results.Items.Item.ItemAttributes.Publisher;
		    			}

		    			if(results.Items.Item.ItemAttributes.PublicationDate != undefined){
		    				pubdate = results.Items.Item.ItemAttributes.PublicationDate;
		    			}

		    			if(results.Items.Item.ItemAttributes.Title != undefined){
		    				title = results.Items.Item.ItemAttributes.Title;
		    			}
	    			}

	    			if(results.Items.Item.LargeImage != undefined && results.Items.Item.LargeImage.URL != undefined){
	    				image = results.Items.Item.LargeImage.URL;
	    			} else {
	    				image = '';
	    			}

	    			if(results.Items.Item.EditorialReviews != undefined && results.Items.Item.EditorialReviews.EditorialReview != undefined && results.Items.Item.EditorialReviews.EditorialReview.Content){
	    				description = results.Items.Item.EditorialReviews.EditorialReview.Content;
	    				description = description.replace(/"/g,'\'');
	    				description = description.replace(/“/g,'\'');
	    			}

	    			if(description == ''){
	    				if(results.Items.Item.EditorialReviews != undefined && results.Items.Item.EditorialReviews.EditorialReview[0] != undefined){
		    				description = results.Items.Item.EditorialReviews.EditorialReview[0].Content;
		    				description = description.replace(/"/g,'\'');
		    				description = description.replace(/“/g,'\'');
	    				}
	    			}
	    		}

	    		// Now build offer price with the saved pricing scheme data
	    		//0-20000-30-8;20001-30000-20-6
				console.log('pricingScheme[0]')
				console.log(pricingScheme[0])
	    		var tempPricingScheme = pricingScheme[0].rankcalcs.split(';');
	    		var loopControl2 = tempPricingScheme.length;
	    		var finalPrice = 0.00;
	    		var finalPriceWithoutSym = 0.00;
	    		var threshold = 0.00;

	    		
	    		for (var r = 0; r < loopControl2; r++) {

	    			if(finalPrice == 0.00){

		    			var tempPricingScheme2 = tempPricingScheme[r].split('-');

		    			if(itemRank >= parseInt(tempPricingScheme2[0]) && itemRank <= parseInt(tempPricingScheme2[1])){
		    				
		    				var monetarySymbol = lowestUsedFormatted.substring(0,1);
		    				var amountForCalc = lowestUsedFormatted.substring(1);

		    				finalPrice = (amountForCalc*(tempPricingScheme2[2]*0.01)).toFixed(2);
		    				finalPriceWithoutSym = finalPrice;
		    				finalPrice = monetarySymbol+finalPrice;
		    				threshold = tempPricingScheme2[3];
		    			}
	    			}
	    		};

	    		var disabledButton="";
	    		var buttonOpacity = 1;
	    		var inlinePriceStyle = '';
	    		if(finalPrice == 0 || finalPrice == 0.00 || finalPriceWithoutSym < threshold){
	    			finalPrice = "Sorry, we're unable to purchase this title!";
	    			inlinePriceStyle = 'bottom:0; font-size:18px;';
	    			disabledButton = 'disabled';
	    			buttonOpacity = 0;
	    		}
	    	};

	    	return finalPrice;
    	}		    	
    }



});